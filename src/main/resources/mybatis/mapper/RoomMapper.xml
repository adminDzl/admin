<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="RoomMapper">

	<resultMap type="com.wolves.dto.RoomDTO" id="ResultMap">
		<result column="room_id" property="id"/>
		<result column="room_name" property="name"/>
		<result column="floorman_id" property="floormanId"/>
	</resultMap>

	<!-- 新增-->
	<insert id="save" parameterType="pd">
		insert into ROOM(
			FLOORMAN_ID,	
			ROOM_NAME,	
			ROOM_ID,
			create_time,
			update_time
		) values (
			#{FLOORMAN_ID},	
			#{ROOM_NAME},	
			#{ROOM_ID},
			now(),
			now()
		)
	</insert>
	<!-- 删除-->
	<delete id="delete" parameterType="pd">
		delete from ROOM
		where 
			ROOM_ID = #{ROOM_ID}
	</delete>
	<!-- 修改 -->
	<update id="edit" parameterType="pd">
		update  ROOM
			set 
				ROOM_NAME = #{ROOM_NAME},
				FLOORMAN_ID=#{FLOORMAN_ID},
				COMPANY_ID=#{COMPANY_ID},
				update_time = now()
			where 
				ROOM_ID = #{ROOM_ID}
	</update>
	<!-- 通过ID获取数据 -->
	<select id="findById" parameterType="pd" resultType="pd">
		select 
			FLOORMAN_ID,	
			ROOM_NAME,	
			ROOM_ID
		from 
			ROOM
		where 
			ROOM_ID = #{ROOM_ID}
	</select>
	<!-- 列表 -->
	<select id="datalistPage" parameterType="page" resultType="pd">
		SELECT
			a.FLOORMAN_ID,
			a.ROOM_NAME,
			a.ROOM_ID,
			f.floor,
			f.build_no,
			c.company_name
		FROM
			ROOM a
		LEFT JOIN floor_man f ON (f.floorman_id = a.floorman_id)
		left join company c on a.company_id=c.company_id
		WHERE 1=1
		<if test="pd.build_no != '' and pd.build_no != null ">
			AND a.build_no = #{pd.build_no, jdbcType=VARCHAR}
		</if>
		<if test="pd.lastLoginStart != '' and pd.lastLoginStart != null ">
			<![CDATA[  AND DATE_FORMAT(a.create_time, '%Y-%m-%d') >= DATE_FORMAT(#{pd.lastLoginStart, jdbcType=VARCHAR}, '%Y-%m-%d') ]]>
		</if>
		<if test="pd.lastLoginEnd != '' and pd.lastLoginEnd != null ">
			<![CDATA[  AND DATE_FORMAT(a.create_time, '%Y-%m-%d') <= DATE_FORMAT(#{pd.lastLoginEnd, jdbcType=VARCHAR}, '%Y-%m-%d') ]]>
		</if>
		ORDER BY a.create_time DESC
	</select>
	<!-- 列表(全部) -->
	<select id="listAll" parameterType="pd" resultType="pd">
		select
				a.FLOORMAN_ID,	
				a.ROOM_NAME,	
				a.ROOM_ID
		from 
				ROOM a
	</select>
	<!-- 批量删除 -->
	<delete id="deleteAll" parameterType="String">
		delete from ROOM
		where 
			ROOM_ID in
		<foreach item="item" index="index" collection="array" open="(" separator="," close=")">
                 #{item}
		</foreach>
	</delete>

	<select id="selectRoomByFloor" parameterType="com.wolves.dto.RoomDTO" resultMap="ResultMap">
		  SELECT
		  room_id,
		  room_name
		  FROM room
		  WHERE floorman_id = #{floormanId}
	</select>

	<select id="selectRoomByCompanyId" parameterType="com.wolves.dto.RoomDTO" resultMap="ResultMap">
		SELECT
		room_id,
		floorman_id,
		room_name
		FROM room
		WHERE company_id = #{companyId}
	</select>
</mapper>